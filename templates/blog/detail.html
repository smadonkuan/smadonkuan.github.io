{% extends 'base.html' %}

{% block title %}{{ post.title }} - myblog{% endblock %}

<!-- ===== æ–‡ç« å…§å®¹ç‰¹æ®Šæ¨£å¼ ===== -->
{% block extra_css %}
<style>
    /* ===== ä»£ç¢¼å¡Šæ¨£å¼ ===== */
    pre {
        background: #f5f5f5;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        overflow-x: auto;
        margin: 20px 0;
    }
    
    /* ===== ç¨‹å¼ç¢¼å­—é«” ===== */
    code {
        font-family: 'Monaco', 'Courier New', monospace;
        font-size: 14px;
        color: #333;
        line-height: 1.6;
    }
    
    /* ===== æ®µè½ ===== */
    p {
        margin-bottom: 15px;
        color: #000000;
    }
    
    /* ===== äºŒç´šæ¨™é¡Œ ===== */
    h2 {
        font-size: 20px;
        font-weight: 700;
        margin-top: 30px;
        margin-bottom: 15px;
        color: #000000;
        border-bottom: 2px solid #0099ff;
        padding-bottom: 10px;
    }
    
    /* ===== ä¸‰ç´šæ¨™é¡Œ ===== */
    h3 {
        font-size: 17px;
        font-weight: 600;
        margin-top: 20px;
        margin-bottom: 10px;
        color: #000;
    }
    
    /* ===== åˆ—è¡¨ ===== */
    ul, ol {
        margin-left: 20px;
        margin-bottom: 15px;
    }
    
    li {
        margin-bottom: 8px;
        color: #666;
    }
    
    /* ===== è¡¨æ ¼ ===== */
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
    }
    
    th, td {
        border: 1px solid #e0e0e0;
        padding: 12px;
        text-align: left;
    }
    
    th {
        background: #f5f5f5;
        font-weight: 600;
    }
    
    /* ===== å¼•ç”¨å€å¡Š ===== */
    blockquote {
        border-left: 4px solid #0099ff;
        padding-left: 20px;
        margin-left: 0;
        color: #999;
        font-style: italic;
    }
    
    hr {
        border: none;
        border-top: 1px solid #e0e0e0;
        margin: 30px 0;
    }
    
    /* ===== æ–‡ç« å¸ƒå±€ï¼šå·¦å…§å®¹ + å³ç›®éŒ„ ===== */
    .article-container {
        display: grid;
        grid-template-columns: 1fr 280px;
        gap: 40px;
    }
    
    /* ===== å³é‚Šç›®éŒ„æ¨£å¼ ===== */
    /* sticky = æ»¾å‹•æ™‚æœƒå›ºå®šåœ¨é ‚éƒ¨ */
    .toc {
        background: #f9f9f9;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 20px;
        position: sticky;      /* é‡é»ï¼šsticky æœƒè·Ÿè‘—æ»¾å‹• */
        top: 20px;             /* è·é ‚éƒ¨ 20px æ™‚å›ºå®š */
        max-height: calc(100vh - 40px);  /* ä¸è¶…éè¢å¹•é«˜åº¦ */
        overflow-y: auto;      /* å…§å®¹éå¤šå¯æ»¾å‹• */
        font-size: 13px;
    }
    
    .toc h4 {
        margin: 0 0 15px 0;
        font-size: 14px;
        color: #333;
        font-weight: 600;
    }
    
    .toc ul {
        list-style: none;
        margin: 0;
        padding: 0;
    }
    
    .toc li {
        margin-bottom: 8px;
        color: #666;
    }
    
    .toc a {
        color: #0099ff;
        text-decoration: none;
        transition: all 0.3s;
    }
    
    .toc a:hover {
        color: #E8714C;
        margin-left: 5px;
    }
    
    /* äºŒç´šç›®éŒ„ */
    .toc ul ul {
        margin-left: 15px;
        margin-top: 8px;
        padding-top: 8px;
        border-left: 2px solid #e0e0e0;
    }
    
    /* æ‰‹æ©Ÿç‰ˆé©é… */
    @media (max-width: 1024px) {
        .article-container {
            grid-template-columns: 1fr;
        }
        .toc {
            position: static;
            max-height: none;
            margin-bottom: 40px;
        }
    }
</style>
{% endblock %}

{% block content %}

<!-- ===== è¿”å›æŒ‰éˆ• ===== -->
<div style="margin-bottom: 40px;">
    <a href="/blog/" style="color: #0099ff; text-decoration: none; font-size: 14px;">â† Back to Blog</a>
</div>

<!-- ===== æ–‡ç«  + ç›®éŒ„å®¹å™¨ ===== -->
<div class="article-container">
    
    <!-- å·¦é‚Šï¼šæ–‡ç« å…§å®¹ -->
    <article>
        <!-- ===== æ–‡ç« æ¨™é¡Œ ===== -->
        <h1 style="font-size: 32px; font-weight: 700; margin-bottom: 20px; color: #000;">{{ post.title }}</h1>
        
        <!-- ===== ç™¼å¸ƒæ™‚é–“å’Œæ›´æ–°æ™‚é–“ ===== -->
        <div style="color: #999; font-size: 14px; margin-bottom: 30px;">
            {{ post.created_at|date:"F d, Y" }}
            {% if post.updated_at != post.created_at %}
            Â· Updated {{ post.updated_at|date:"F d, Y" }}
            {% endif %}
        </div>
        
        <!-- ===== æ¨™ç±¤ ===== -->
        <div class="tech-stack" style="margin-bottom: 50px;">
            {% for tag in post.get_tags %}
            <span class="tech-badge">{{ tag }}</span>
            {% endfor %}
        </div>
        
        <!-- ===== æ–‡ç« å…§å®¹ ===== -->
        <!-- markdown è‡ªå‹•è½‰æˆ HTMLï¼Œ|safe è¡¨ç¤ºå…è¨± HTML æ¨™ç±¤ -->
        <div style="margin: 60px 0; color: #666; line-height: 1.9; font-size: 15px;">
            {{ post.get_content_html|safe }}
        </div>
        
        <!-- ===== è¿”å›é€£çµ ===== -->
        <div style="border-top: 1px solid #e0e0e0; padding-top: 40px; margin-top: 80px;">
            <a href="/blog/" class="btn">â† Back to Blog</a>
        </div>
    </article>
    
    <!-- å³é‚Šï¼šç›®éŒ„ -->
    <aside class="toc" id="toc-container">
        <h4>ğŸ“‹ ç›®éŒ„</h4>
        <ul id="toc-list">
            <!-- JavaScript æœƒè‡ªå‹•å¡«å……é€™è£¡ -->
        </ul>
    </aside>
    
</div>

<!-- ===== JavaScriptï¼šè‡ªå‹•ç”Ÿæˆç›®éŒ„ ===== -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const article = document.querySelector('article');
    const tocList = document.getElementById('toc-list');
    
    // æƒææ‰€æœ‰ h2 å’Œ h3 æ¨™é¡Œ
    const headings = article.querySelectorAll('h2, h3');
    
    if (headings.length === 0) {
        document.getElementById('toc-container').style.display = 'none';
        return;
    }
    
    tocList.innerHTML = '';
    let lastH2Li = null;
    let currentUL = tocList;
    
    headings.forEach((heading, index) => {
        // çµ¦æ¨™é¡ŒåŠ  id
        if (!heading.id) {
            heading.id = `heading-${index}`;
        }
        
        const level = heading.tagName; // 'H2' æˆ– 'H3'
        const text = heading.textContent;
        
        // å»ºç«‹ç›®éŒ„é …ç›®
        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#${heading.id}`;
        a.textContent = text;
        li.appendChild(a);
        
        if (level === 'H2') {
            // æ˜¯ h2ï¼šåŠ åˆ°ä¸»åˆ—è¡¨
            tocList.appendChild(li);
            lastH2Li = li;
            currentUL = tocList;
        } else if (level === 'H3') {
            // æ˜¯ h3ï¼šå¦‚æœå‰é¢æœ‰ h2ï¼Œå°±åŠ ç‚ºå­é …
            if (lastH2Li) {
                // å¦‚æœå­åˆ—è¡¨é‚„ä¸å­˜åœ¨ï¼Œå°±å»ºç«‹
                if (!lastH2Li.querySelector('ul')) {
                    const subUL = document.createElement('ul');
                    lastH2Li.appendChild(subUL);
                }
                lastH2Li.querySelector('ul').appendChild(li);
            } else {
                // å¦‚æœæ²’æœ‰å‰é¢çš„ h2ï¼Œå°±ç›´æ¥åŠ åˆ°ä¸»åˆ—è¡¨
                tocList.appendChild(li);
            }
        }
    });
});
</script>

{% endblock %}